<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ç°¡å˜é›»æ°—å›è·¯ã‚²ãƒ¼ãƒ </title>
<style>
  body {
    font-family: sans-serif;
    text-align: center;
    padding: 10px;
  }

  .grid {
    display: grid;
    margin: 10px auto;
    justify-content: center;
    width: 100%;
    max-width: 420px;
  }

  .cell {
    width: min(60px, 14vw);
    height: min(60px, 14vw);
    border: 1px solid #333;
    display: flex;
    justify-content: center;
    align-items: center;
    font-size: min(28px, 6vw);
    cursor: pointer;
    user-select: none;
    transition: background-color 0.2s;
  }

  #parts button, button {
    font-size: min(18px, 5vw);
    padding: 6px 10px;
    margin: 4px;
    width: min(120px, 30vw);
  }

  h1 { font-size: min(26px, 7vw); }
  h2 { font-size: min(22px, 6vw); }
</style>
</head>
<body>

<h1>ğŸ”Œ é›»æ°—å›è·¯ã‚²ãƒ¼ãƒ </h1>
<div id="question">ãƒ‘ãƒ¼ãƒ„ã‚’ç½®ã„ã¦ã€ã‚¹ã‚¤ãƒƒãƒã‹ã‚‰é›»çƒã¾ã§ã¤ãªã’ã‚ˆã†ï¼</div>

<div id="parts">
  <button onclick="selectPart('â”€')">æ¨ªç·š â”€</button>
  <button onclick="selectPart('â”‚')">ç¸¦ç·š â”‚</button>
  <button onclick="selectPart('â”Œ')">â”Œ</button>
  <button onclick="selectPart('â”')">â”</button>
  <button onclick="selectPart('â””')">â””</button>
  <button onclick="selectPart('â”˜')">â”˜</button>
  <button onclick="selectPart('â”¼')">åå­— â”¼</button>
</div>

<div id="grid" class="grid"></div>

<button onclick="checkGoal()">ãƒã‚§ãƒƒã‚¯</button>
<button onclick="resetGrid()">ãƒªã‚»ãƒƒãƒˆ</button>

<h2 id="result"></h2>

<script>
let rows = 7, cols = 5; 
let selectedPart = 'â”€';
let gridData = Array(rows).fill().map(()=>Array(cols).fill(''));
const gridEl = document.getElementById('grid');

gridEl.style.gridTemplateColumns = `repeat(${cols}, min(60px, 14vw))`;

let bulb1 = {r: rows-1, c: cols-1};
let bulb2 = {r: rows-1, c: 0};

function initGrid(){
  gridEl.innerHTML = '';
  for(let r=0;r<rows;r++){
    for(let c=0;c<cols;c++){
      const cell = document.createElement('div');
      cell.className = 'cell';
      cell.id = `cell-${r}-${c}`;   // â† ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã«IDè¿½åŠ 

      if(r===0 && c===0) cell.textContent = 'ğŸ”²';
      else if(r===bulb1.r && c===bulb1.c) cell.textContent = 'ğŸ’¡';
      else if(r===bulb2.r && c===bulb2.c) cell.textContent = 'ğŸ’¡';

      cell.addEventListener('click', ()=>placePart(r,c,cell));
      gridEl.appendChild(cell);
    }
  }
}
initGrid();

function selectPart(part){ selectedPart = part; }

function placePart(r,c,cell){
  if(r===0 && c===0) return;
  if((r===bulb1.r && c===bulb1.c)||(r===bulb2.r && c===bulb2.c)) return;
  gridData[r][c] = selectedPart;
  cell.textContent = selectedPart;
}

const directions = {
  'â”€': [[0,-1],[0,1]],
  'â”‚': [[-1,0],[1,0]],
  'â”Œ': [[0,1],[1,0]],
  'â”': [[0,-1],[1,0]],
  'â””': [[0,1],[-1,0]],
  'â”˜': [[0,-1],[-1,0]],
  'â”¼': [[-1,0],[1,0],[0,-1],[0,1]]
};

/* ---------------------------
   ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³æ©Ÿèƒ½
--------------------------- */

// é€šã£ãŸçµŒè·¯ã‚’å…‰ã‚‰ã›ã‚‹
function animatePath(path){
  path.forEach((p, i)=>{
    setTimeout(()=>{
      const el = document.getElementById(`cell-${p.r}-${p.c}`);
      el.style.backgroundColor = "yellow";
      setTimeout(()=> el.style.backgroundColor="", 150);
    }, 80 * i);
  });
}

// é›»çƒã®ç‚¹æ»…
function flashBulb(bulb){
  const el = document.getElementById(`cell-${bulb.r}-${bulb.c}`);
  el.textContent = "âœ¨ğŸ’¡âœ¨";
  setTimeout(()=> el.textContent="ğŸ’¡", 600);
}


function checkGoal(){
  const visited = Array(rows).fill().map(()=>Array(cols).fill(false));

  let reached1 = false, reached2 = false;
  let path = [];  // â† DFSé€šéä½ç½®ã‚’è¨˜éŒ²

  function dfs(r,c){
    if(r<0||r>=rows||c<0||c>=cols) return;
    if(visited[r][c]) return;

    visited[r][c]=true;
    path.push({r,c}); // â† çµŒè·¯ã‚’è¿½åŠ 

    if(r===bulb1.r && c===bulb1.c) reached1=true;
    if(r===bulb2.r && c===bulb2.c) reached2=true;

    const part = (r===0 && c===0)?'â”¼':gridData[r][c];
    if(!part) return;

    for(let [dr,dc] of directions[part]){
      dfs(r+dr, c+dc);
    }
  }

  dfs(0,0);

  animatePath(path); // â† ã“ã“ã§é›»æ°—ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒèµ°ã‚‹

  if(reached1 && reached2){
    document.getElementById('result').textContent = 'ğŸ‰ ã‚´ãƒ¼ãƒ«ï¼';

    flashBulb(bulb1);
    flashBulb(bulb2);

    setTimeout(()=> moveBulbsRandom(), 800);
  } else {
    document.getElementById('result').textContent = 'æ®‹å¿µï¼';
  }
}

function moveBulbsRandom(){
  function getRandomCell(){
    let r,c;
    do{
      r = Math.floor(Math.random()*rows);
      c = Math.floor(Math.random()*cols);
    }while(r===0 && c===0);
    return {r,c};
  }
  bulb1 = getRandomCell();
  do{ bulb2 = getRandomCell(); }
  while(bulb2.r===bulb1.r && bulb2.c===bulb1.c);

  resetGrid();
}

function resetGrid(){
  gridData = Array(rows).fill().map(()=>Array(cols).fill(''));
  initGrid();
  document.getElementById('result').textContent='';
}
</script>

</body>
</html>
